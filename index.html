<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Karnaugh Map Solver</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<div class="app">
  <!-- CONTROL PANEL -->
  <aside class="panel">

    <!-- Defined by -->
    <div class="dropdown">
      <button class="dropdown-btn fixed-label" id="definedByBtn">
        Defined by ‚ñº
      </button>
      <ul class="dropdown-menu no-scroll" id="definedByMenu">
        <li data-target="kmap">K-map</li>
        <li data-target="expression">Boolean Expression</li>
        <li data-target="term">Minterms</li>
        <li data-target="term">Maxterms</li>
        <li data-target="truth">Truth Table</li>
      </ul>
    </div>

    <!-- Variables -->
    <div class="dropdown">
      <button class="dropdown-btn" id="varBtn">4 Variables ‚ñº</button>
      <ul class="dropdown-menu no-scroll">
        <li data-val="2">2</li>
        <li data-val="3">3</li>
        <li data-val="4" class="active">4</li>
        <li data-val="5">5</li>
        <li data-val="6">6</li>
      </ul>
    </div>

    <!-- SOP / POS -->
    <div class="dropdown">
      <button class="dropdown-btn" id="formBtn">SOP ‚ñº</button>
      <ul class="dropdown-menu">
        <li class="active">SOP</li>
        <li>POS</li>
      </ul>
    </div>

    <!-- Solve -->
    <button class="solve-btn">ENTER TO SOLVE</button>

  </aside>

  <!-- MAIN CONTENT -->
  <main class="content">
  
    <section id="expression" class="block">
      <h2>Boolean Expression</h2>
      <input id="origExpr" placeholder="Original Expression">
      <input id="dcExpr" placeholder="Don't Care Expression">
      <input id="simpExpr" placeholder="SOP Simplified Expression" disabled>
      <button class="instruction-toggle">Instruction</button>
      <div class="instruction-panel" id="expressionInstruction">
        <p><strong>Instruction</strong></p>
      
        <p>
          <strong>Allowed variables:</strong>
          <span id="allowedVars">A, B, C, D</span>
        </p>
      
        <p><strong>Operators:</strong></p>
        <ul>
          <li>+ = OR</li>
          <li>* = AND</li>
          <li>' = NOT</li>
          <li>( ) = GROUP</li>
        </ul>
      
        <p>Invalid characters will be removed automatically.</p>
      </div>

    </section>
  
    <section id="term" class="block">
      <h2 id="termTitle">Minterm</h2>
      <input id="termInput" placeholder="Minterm">
      <input id="dcTerm" placeholder="Don't Care Term">
      <input id="termAfter" placeholder="After Simplify" disabled>
    </section>
  
    <section id="truth" class="block">
      <h2>Truth Table</h2>
      <p>Truth table visualization</p>
    </section>
  
    <section id="kmap" class="block">
      <h2>K-map</h2>
      <p>K-map visualization</p>
    </section>
  
  </main>
</div>

<script>
  // Generic dropdown behavior
  document.querySelectorAll(".dropdown").forEach(drop => {
    const btn = drop.querySelector(".dropdown-btn");
    const menu = drop.querySelector(".dropdown-menu");

    btn.addEventListener("click", () => {
      menu.classList.toggle("show");
    });

    menu.querySelectorAll("li").forEach(item => {
      item.addEventListener("click", () => {
        // active state
        menu.querySelectorAll("li").forEach(li => li.classList.remove("active"));
        item.classList.add("active");
        // label logic + varCount
        if (btn.id === "varBtn") {
          varCount = parseInt(item.dataset.val, 10);
          btn.textContent = `${varCount} Variables ‚ñº`;
          updateAllowedVars();
        }
        else if (!btn.classList.contains("fixed-label")) {
          btn.textContent = `${item.textContent} ‚ñº`;
        }

        menu.classList.remove("show");
      });
    });
  });

  // close dropdown when clicking outside
  document.addEventListener("click", e => {
    document.querySelectorAll(".dropdown").forEach(drop => {
      if (!drop.contains(e.target)) {
        drop.querySelector(".dropdown-menu").classList.remove("show");
      }
    });
  });
  let currentDefinedBy = "Minterms";
  let currentForm = "SOP";
  
  function updateUIFromState() {
    // ƒê·ªìng b·ªô currentForm theo currentDefinedBy
    if (currentDefinedBy === "Minterms") currentForm = "SOP";
    else if (currentDefinedBy === "Maxterms") currentForm = "POS";
  
    // C·∫≠p nh·∫≠t dropdown Defined by
    const definedByBtn = document.getElementById("definedByBtn");
    definedByBtn.textContent = currentDefinedBy + " ‚ñº";
    document.querySelectorAll("#definedByMenu li").forEach(li => {
      li.classList.toggle("active", li.textContent === currentDefinedBy);
    });
  
    // C·∫≠p nh·∫≠t dropdown SOP/POS
    const formBtn = document.getElementById("formBtn");
    formBtn.textContent = currentForm + " ‚ñº";
    document.querySelectorAll("#formBtn + .dropdown-menu li").forEach(li => {
      li.classList.toggle("active", li.textContent === currentForm);
    });
  
    // C·∫≠p nh·∫≠t ph·∫ßn Term
    const termTitle = document.getElementById("termTitle");
    const termInput = document.getElementById("termInput");
    const termAfter = document.getElementById("termAfter");
    const simpExpr = document.getElementById("simpExpr");
  
    if (currentForm === "SOP") {
      termTitle.textContent = "Minterm";
      termInput.placeholder = "Minterm";
      termAfter.placeholder = "Minterm After Simplify";
      simpExpr.placeholder = "SOP Simplified Expression";
    } else {
      termTitle.textContent = "Maxterm";
      termInput.placeholder = "Maxterm";
      termAfter.placeholder = "Maxterm After Simplify";
      simpExpr.placeholder = "POS Simplified Expression";
    }
  
    // Hi·ªÉn th·ªã section t∆∞∆°ng ·ª©ng
    document.querySelectorAll("main .block").forEach(block => block.style.display = "none");
    let showSectionId = "term";
    if (currentDefinedBy === "expression") showSectionId = "expression";
    else if (currentDefinedBy === "kmap") showSectionId = "kmap";
    else if (currentDefinedBy === "truth") showSectionId = "truth";
  
    const showSection = document.getElementById(showSectionId);
    if (showSection) {
      showSection.style.display = "block";
      // üî• Scroll ƒë·∫øn section t∆∞∆°ng ·ª©ng
      showSection.scrollIntoView({ behavior: "smooth", block: "start" });
    }
  
  // Khi ch·ªçn Defined by
  document.querySelectorAll("#definedByMenu li").forEach(li => {
    li.addEventListener("click", () => {
      currentDefinedBy = li.textContent;
      updateUIFromState();
    });
  });
  
  // Khi ch·ªçn SOP/POS
  document.querySelectorAll("#formBtn + .dropdown-menu li").forEach(li => {
    li.addEventListener("click", () => {
      currentForm = li.textContent;
      // ƒê·ªìng b·ªô definedBy khi ƒë·ªïi SOP/POS
      currentDefinedBy = currentForm === "SOP" ? "Minterms" : "Maxterms";
      updateUIFromState();
    });
  });
  
  // G·ªçi l·∫ßn ƒë·∫ßu ƒë·ªÉ c·∫≠p nh·∫≠t UI
  updateUIFromState();


  let currentMode = null;
  
  ["origExpr", "dcExpr"].forEach(id => {
    document.getElementById(id).addEventListener("focus", () => {
      currentMode = "expression";
      console.log("MODE: EXPRESSION");
    });
  });
  
  ["termInput", "dcTerm"].forEach(id => {
    document.getElementById(id).addEventListener("focus", () => {
      currentMode = "term";
      console.log("MODE: TERM");
    });
  });
  let varCount = 4;
  const varMap = {
    2: ["A","B"],
    3: ["A","B","C"],
    4: ["A","B","C","D"],
    5: ["A","B","C","D","E"],
    6: ["A","B","C","D","E","F"]
  };
  // ================= FILTER FUNCTIONS =================
  
  // filter Boolean Expression input
  function filterExpression(input) {
    const allowed = varMap[varCount].join("");
    const regex = new RegExp(`[^${allowed}'()+* ]`, "gi");
    input.value = input.value.replace(regex, "");
  }
  
  // filter Minterm / Maxterm input
  function filterTermRealtime(input) {
    // ch·ªâ cho s·ªë, d·∫•u ph·∫©y v√† space
    let v = input.value.replace(/[^0-9, ]/g, "");
  
    // kh√¥ng cho nhi·ªÅu d·∫•u ph·∫©y li√™n ti·∫øp
    v = v.replace(/,+/g, ",");
  
    const maxTerm = (1 << varCount) - 1;
  
    const parts = v.split(",");
  
    for (let i = 0; i < parts.length; i++) {
      const t = parts[i].trim();
  
      // ƒëang g√µ d·ªü ‚Üí cho qua
      if (t === "") continue;
  
      const n = Number(t);
  
      // v∆∞·ª£t range ho·∫∑c kh√¥ng ph·∫£i s·ªë ‚Üí x√≥a ngay
      if (!Number.isInteger(n) || n < 0 || n > maxTerm) {
        parts[i] = "";
      }
    }
  
    input.value = parts.join(",");
  }
  const origExpr = document.getElementById("origExpr");
  const dcExpr = document.getElementById("dcExpr");
  const dcTerm = document.getElementById("dcTerm");
  // ================= ATTACH EVENTS =================
  origExpr.addEventListener("input", () => filterExpression(origExpr));
  dcExpr.addEventListener("input", () => filterExpression(dcExpr));
  
  termInput.addEventListener("input", () =>
    filterTermRealtime(termInput)
  );
  
  dcTerm.addEventListener("input", () =>
    filterTermRealtime(dcTerm)
  );
  const instrToggle = document.querySelector(".instruction-toggle");
  const instrPanel = document.getElementById("expressionInstruction");
  
  instrToggle.addEventListener("click", () => {
    instrPanel.style.display =
      instrPanel.style.display === "block" ? "none" : "block";
  });
  function updateAllowedVars() {
    document.getElementById("allowedVars").textContent =
      varMap[varCount].join(", ");
  }
  updateAllowedVars();
  setForm(currentForm);
</script>

</body>
</html>
