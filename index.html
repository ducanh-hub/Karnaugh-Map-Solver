<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Karnaugh Map Solver</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<div class="app">
  <!-- CONTROL PANEL -->
  <aside class="panel">

    <!-- Defined by -->
    <div class="dropdown">
      <button class="dropdown-btn fixed-label" id="definedByBtn">
        Defined by ▼
      </button>
      <ul class="dropdown-menu scroll" id="definedByMenu">
        <li data-target="kmap">K-map</li>
        <li data-target="expression">Boolean Expression</li>
        <li data-target="term">Minterms</li>
        <li data-target="term">Maxterms</li>
        <li data-target="truth">Truth Table</li>
      </ul>
    </div>

    <!-- Variables -->
    <div class="dropdown">
      <button class="dropdown-btn" id="varBtn">4 Variables ▼</button>
      <ul class="dropdown-menu">
        <li data-val="2">2</li>
        <li data-val="3">3</li>
        <li data-val="4" class="active">4</li>
        <li data-val="5">5</li>
        <li data-val="6">6</li>
      </ul>
    </div>

    <!-- SOP / POS -->
    <div class="dropdown">
      <button class="dropdown-btn" id="formBtn">SOP ▼</button>
      <ul class="dropdown-menu">
        <li class="active">SOP</li>
        <li>POS</li>
      </ul>
    </div>

    <!-- Solve -->
    <button class="solve-btn">ENTER TO SOLVE</button>

  </aside>

  <!-- MAIN CONTENT -->
  <main class="content">
  
    <section id="expression" class="block">
      <h2>Boolean Expression</h2>
      <input id="origExpr" placeholder="Original Expression">
      <input id="dcExpr" placeholder="Don't Care Expression">
      <input id="simpExpr" placeholder="Simplified Expression" disabled>
      <button class="instruction-toggle">Instruction ▼</button>
      <div class="instruction-panel" id="expressionInstruction">
        <p><strong>Instruction</strong></p>
      
        <p>
          <strong>Allowed variables:</strong>
          <span id="allowedVars">A, B, C, D</span>
        </p>
      
        <p><strong>Operators:</strong></p>
        <ul>
          <li>+ = OR</li>
          <li>* = AND</li>
          <li>' = NOT</li>
          <li>( ) = GROUP</li>
        </ul>
      
        <p>Invalid characters will be removed automatically.</p>
      </div>

    </section>
  
    <section id="term" class="block">
      <h2 id="termTitle">Minterm</h2>
      <input id="termInput" placeholder="Minterm">
      <input id="dcTerm" placeholder="Don't Care Term">
      <input id="termAfter" placeholder="After Simplify" disabled>
    </section>
  
    <section id="truth" class="block">
      <h2>Truth Table</h2>
      <p>Truth table visualization</p>
    </section>
  
    <section id="kmap" class="block">
      <h2>K-map</h2>
      <p>K-map visualization</p>
    </section>
  
  </main>
</div>

<script>
  // Generic dropdown behavior
  document.querySelectorAll(".dropdown").forEach(drop => {
    const btn = drop.querySelector(".dropdown-btn");
    const menu = drop.querySelector(".dropdown-menu");

    btn.addEventListener("click", () => {
      menu.classList.toggle("show");
    });

    menu.querySelectorAll("li").forEach(item => {
      item.addEventListener("click", () => {
        // active state
        menu.querySelectorAll("li").forEach(li => li.classList.remove("active"));
        item.classList.add("active");
        // label logic + varCount
        if (btn.id === "varBtn") {
          varCount = parseInt(item.dataset.val, 10);
          btn.textContent = `${varCount} Variables ▼`;
          updateAllowedVars();
        }
        else if (!btn.classList.contains("fixed-label")) {
          btn.textContent = `${item.textContent} ▼`;
        }

        menu.classList.remove("show");
      });
    });
  });

  // close dropdown when clicking outside
  document.addEventListener("click", e => {
    document.querySelectorAll(".dropdown").forEach(drop => {
      if (!drop.contains(e.target)) {
        drop.querySelector(".dropdown-menu").classList.remove("show");
      }
    });
  });
  // Scroll to section when Defined by selected
  const definedByMenu = document.getElementById("definedByMenu");
  
  definedByMenu.querySelectorAll("li").forEach(item => {
    item.addEventListener("click", () => {
      const targetId = item.dataset.target;
      const section = document.getElementById(targetId);
      if (!section) return;
  
      section.scrollIntoView({
        behavior: "smooth",
        block: "start"
      });
    });
  });
  let currentForm = "SOP";
  
  const termTitle = document.getElementById("termTitle");
  const termInput = document.getElementById("termInput");
  const simpExpr = document.getElementById("simpExpr");
  
  document.querySelectorAll("#formBtn + .dropdown-menu li").forEach(item => {
    item.addEventListener("click", () => {
      currentForm = item.textContent;
      document.getElementById("formBtn").textContent = `${currentForm} ▼`;
      if (currentForm === "SOP") {
        termTitle.textContent = "Minterm";
        termInput.placeholder = "Minterm";
        simpExpr.placeholder = "SOP Simplified Expression";
      } else {
        termTitle.textContent = "Maxterm";
        termInput.placeholder = "Maxterm";
        simpExpr.placeholder = "POS Simplified Expression";
      }
    });
  });
  let currentMode = null;
  
  ["origExpr", "dcExpr"].forEach(id => {
    document.getElementById(id).addEventListener("focus", () => {
      currentMode = "expression";
      console.log("MODE: EXPRESSION");
    });
  });
  
  ["termInput", "dcTerm"].forEach(id => {
    document.getElementById(id).addEventListener("focus", () => {
      currentMode = "term";
      console.log("MODE: TERM");
    });
  });
  let varCount = 4;
  const varMap = {
    2: ["A","B"],
    3: ["A","B","C"],
    4: ["A","B","C","D"],
    5: ["A","B","C","D","E"],
    6: ["A","B","C","D","E","F"]
  };
  // ================= FILTER FUNCTIONS =================
  
  // filter Boolean Expression input
  function filterExpression(input) {
    const allowed = varMap[varCount].join("");
    const regex = new RegExp(`[^${allowed}'()+* ]`, "gi");
    input.value = input.value.replace(regex, "");
  }
  
  // filter Minterm / Maxterm input
  function filterTerm(input) {
    const maxTerm = Math.pow(2, varCount) - 1;
  
    input.value = input.value
      .split(",")
      .map(v => v.trim())
      .filter(v => {
        const n = parseInt(v, 10);
        return !isNaN(n) && n >= 0 && n <= maxTerm;
      })
      .join(", ");
  }
  const origExpr = document.getElementById("origExpr");
  const dcExpr = document.getElementById("dcExpr");
  const dcTerm = document.getElementById("dcTerm");
  // ================= ATTACH EVENTS =================
  origExpr.addEventListener("input", () => filterExpression(origExpr));
  dcExpr.addEventListener("input", () => filterExpression(dcExpr));
  
  termInput.addEventListener("input", () => filterTerm(termInput));
  dcTerm.addEventListener("input", () => filterTerm(dcTerm));
  const instrToggle = document.querySelector(".instruction-toggle");
  const instrPanel = document.getElementById("expressionInstruction");
  
  instrToggle.addEventListener("click", () => {
    instrPanel.style.display =
      instrPanel.style.display === "block" ? "none" : "block";
  });
  function updateAllowedVars() {
    document.getElementById("allowedVars").textContent =
      varMap[varCount].join(", ");
  }
  updateAllowedVars();
</script>

</body>
</html>
